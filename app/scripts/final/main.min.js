function createPDF(data,total){var pdf=new jsPDF("p","pt"),columns=[{title:"Nombre",dataKey:"nombre"},{title:"Precio",dataKey:"precio"},{title:"Cantidad",dataKey:"cantidad"}];return console.log(pdf),pdf.autoTable(columns,data,{margin:{top:70},beforePageContent:function(data){pdf.text("Casa Del Bombillo",220,30),pdf.text("Cotizaci칩n",240,50)},afterPageContent:function(tData){pdf.setFontType("bold"),pdf.text("Total: "+total,50,tData.table.height+90)}}),pdf}angular.module("casabombillo",["ngCart","ui.router","auth0.lock","angular-jwt","ngSanitize","ezplus"]).config(function($stateProvider,$urlRouterProvider,$interpolateProvider,lockProvider,jwtOptionsProvider,jwtInterceptorProvider,$httpProvider){$urlRouterProvider.otherwise("/defaultt"),$interpolateProvider.startSymbol("{["),$interpolateProvider.endSymbol("]}"),lockProvider.init({clientID:"OhgmXRdIZ5KaJah0hQsFa5AEYrjbsx85",domain:"ruizoft.auth0.com",options:{language:"es",auth:{redirect:!1}}}),jwtOptionsProvider.config({whiteListedDomains:["localhost"],tokenGetter:function(){return localStorage.getItem("id_token")}}),$httpProvider.interceptors.push("jwtInterceptor"),$stateProvider.state("defaultt",{url:"/defaultt",templateUrl:"templates/default.html",controller:"defaultController as controller"}).state("viewProduct",{url:"/viewProduct",templateUrl:"templates/viewProduct.html",controller:"viewProductController as controller"}).state("perfil",{url:"/perfil",templateUrl:"templates/perfil.html",controller:"perfilController as controller"}).state("pedidos",{url:"/pedidos",templateUrl:"templates/pedidos.html",controller:"pedidosController as controller"}).state("cart",{url:"/cart",templateUrl:"templates/cart.html",controller:"cartController as controller"}).state("coti",{url:"/coti",templateUrl:"templates/coti.html",controller:"cotiController as controller"})}).run(function($rootScope,authService,authManager){authManager.checkAuthOnRefresh(),$rootScope.authService=authService,authService.registerAuthenticationListener()}),angular.module("casabombillo").directive("navBar",function(){return{restrict:"E",templateUrl:"templates/nav.html"}}).directive("product",function(){return{restrict:"E",templateUrl:"templates/product.html",scope:{product:"=",viewProduct:"="}}}).directive("rzInput",function(){return{restrict:"E",templateUrl:"/templates/rzinput.html",scope:{type:"@","float":"@",label:"@",name:"@",id:"@",error:"=",form:"@",ngRequired:"@",ngModel:"=",list:"@",addOn:"@",addName:"@",addFunc:"="}}}).directive("rzSearch",function(){return{restrict:"E",templateUrl:"/templates/rzsearch.html",scope:{type:"@","float":"@",label:"@",name:"@",id:"@",error:"=",form:"@",ngRequired:"@",ngModel:"=",list:"@",search:"=",addName:"@",clickfunc:"="},controller:function($scope){$scope.add=function(item){console.log(item),$scope.clickfunc(item)}}}}).directive("rzTextarea",function(){return{restrict:"E",templateUrl:"/templates/rztextarea.html",scope:{maxlength:"@",rows:"@",label:"@",name:"@",id:"@",error:"=",ngRequired:"@",ngModel:"="}}}).directive("rzSelect",function(){return{restrict:"E",templateUrl:"/templates/rzselect.html",scope:{label:"@",name:"@",id:"@",error:"=",ngRequired:"@",options:"=",ngModel:"=",filterr:"="}}}),angular.module("casabombillo").factory("dataBase",function(){return idb.open("casaBombillo",1,function(upgradeDb){upgradeDb.createObjectStore("productos",{keyPath:"id"}),upgradeDb.createObjectStore("categorias",{keyPath:"id"}),upgradeDb.createObjectStore("pedidos",{keyPath:"id"})})}).service("authService",["$rootScope","lock","authManager",function($rootScope,lock,authManager){function login(){lock.show()}function logout(){localStorage.removeItem("id_token"),localStorage.removeItem("profile"),authManager.unauthenticate(),userProfile={}}function registerAuthenticationListener(){lock.on("authenticated",function(authResult){console.log("auth"),localStorage.setItem("id_token",authResult.idToken),authManager.authenticate(),lock.getProfile(authResult.idToken,function(error,profile){error&&console.log(error),localStorage.setItem("profile",JSON.stringify(profile)),$rootScope.$broadcast("userProfileSet",profile)})})}var userProfile=JSON.parse(localStorage.getItem("profile"))||{};return{userProfile:userProfile,login:login,logout:logout,registerAuthenticationListener:registerAuthenticationListener}}]),angular.module("casabombillo").controller("cartController",["$http","$scope","$rootScope","authService","ngCart","dataBase",function($http,$scope,$rootScope,authService,ngCart,dataBase){var controller=this;this.items=[],this.items=ngCart.getItems(),this.order={},console.log(controller.items),this.comprar=function(){controller.items.forEach(function(product){controller.order.productos?controller.order.productos=controller.order.productos+", "+product._name:controller.order.productos=product._name,controller.order.precio?controller.order.precio=controller.order.precio+product._price:controller.order.precio=product._price}),controller.order.fecha=new Date,controller.order.estado="Pendiente",controller.order.id=Math.round(1e3*Math.random()),dataBase.then(function(db){var pedidoObj=db.transaction("pedidos","readwrite").objectStore("pedidos");pedidoObj.add(controller.order).then(function(){controller.order={},ngCart.empty(),location.href="/#/pedidos"})})}}]),angular.module("casabombillo").controller("cotiController",["$http","$scope","$rootScope",function($http,$scope,$rootScope){var controller=this;this.items=[],this.total=0,this.addItem=function(item){controller.items.includes(item)||(item.cantidad=0,controller.items.push(item),controller.total+=item.precio*item.cantidad,controller.query="")},this.newCantidad=function(item){item.hasOwnProperty("lastCantidad")||(item.lastCantidad=0),item.hasOwnProperty("lastPrice")||(item.lastPrice=0),item.cantidad>0&&item.cantidad>item.lastCantidad?(console.log(item.cantidad),console.log(item.precio*item.cantidad),item.lastPrice=item.precio*item.cantidad,item.lastCantidad=item.cantidad,controller.total+=item.precio*item.cantidad,console.log(controller.total)):(controller.total-=item.lastPrice,item.lastPrice=item.cantidad*item.precio,item.lastCantidad=item.cantidad)},this.downloadPDF=function(){var pdf=createPDF(controller.items,controller.total);pdf.save("casabombillo-cotizacion.pdf")},this.sendPDF=function(){var pdf=createPDF(controller.items,controller.total),pdfOutput=pdf.output(),columns=["Nombre","Precio","Cantidad"];$http.post("http://localhost/sendMail",{pdf:pdfOutput,email:controller.email,data:{items:controller.items,total:controller.total,columns:columns}}).then(function(response){console.log("message sent")})["catch"](function(error){console.log(error)})}}]),angular.module("casabombillo").controller("defaultController",["$http","$scope","$rootScope","authService",function($http,$scope,$rootScope,authService){this.viewProduct=function(producto){console.log(1),$rootScope.activeProduct=producto,location.href="/#/viewProduct"}}]),angular.module("casabombillo").controller("mainController",["$http","$scope","$rootScope","authService",function($http,$scope,$rootScope,authService){var controller=this;$rootScope.productos=[],$rootScope.categorias=[],$rootScope.activeProduct={},$rootScope.activeCategoria={},this.user={},this.setCategoria=function(cat){$rootScope.activeCategoria=cat},this.getProducts=function(){$http.get("http://localhost/getProducts").then(function(response){$rootScope.productos=response.data})["catch"](function(error){console.log(error)})},this.getCategories=function(){$http.get("http://localhost/getCategories").then(function(response){$rootScope.categorias=response.data})["catch"](function(error){console.log(error)})},this.getProducts(),this.getCategories(),this.login=function(){authService.login()},this.logout=function(){authService.logout()},this.showProfile=function(){location.href="#/perfil"},controller.user=authService.userProfile,$rootScope.$on("userProfileSet",function(data){console.log(data),controller.user=JSON.parse(localStorage.getItem("profile"))||{}})}]),angular.module("casabombillo").controller("pedidosController",["$http","$scope","$rootScope","authService","dataBase",function($http,$scope,$rootScope,authService,dataBase){var controller=this;this.pedidos=[{id:1,productos:"Bombillo, Cable, Ba침o",precio:5e4,fecha:new Date,estado:"Enviado"},{id:2,productos:"Nevera, Cable, Ba침o",precio:1e5,fecha:new Date,estado:"Enviado"},{id:3,productos:"Tubos, Cable, Ba침o",precio:2e4,fecha:new Date,estado:"Enviado"},{id:4,productos:"Tacos, Cable, Cocina",precio:8e4,fecha:new Date,estado:"Enviado"}],this.getPedidosDB=function(){dataBase.then(function(db){var pedidosObj=db.transaction("pedidos").objectStore("pedidos");pedidosObj.getAll().then(function(pedidos){0!=pedidos.length&&(controller.pedidos=controller.pedidos.concat(pedidos),$scope.$apply())})})},this.getPedidosDB()}]),angular.module("casabombillo").controller("perfilController",["$http","$scope","$rootScope","authService",function($http,$scope,$rootScope,authService){}]),angular.module("casabombillo").controller("viewProductController",["$http","$scope","$rootScope","$sce",function($http,$scope,$rootScope,$sce){var controller=this;this.product=$rootScope.activeProduct,this.activeImg,this.arrangeProduct=function(){return 0==Object.keys(controller.product)?void(location.href="/#/defaultt"):("string"==typeof controller.product.galery&&(controller.product.galery=controller.product.galery.split(","),controller.product.galery.pop()),"string"==typeof controller.product.tags&&(controller.product.tags=controller.product.tags.split(","),controller.product.tags.pop()),void(controller.activeImg=controller.product.image))},this.setImg=function(image){controller.product.galery.push(controller.activeImg),controller.activeImg=image;var index=controller.product.galery.indexOf(image);controller.product.galery.splice(index,1)},this.arrangeProduct()}]);